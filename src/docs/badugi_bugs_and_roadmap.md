## 5. Spec 09+ Implementation Backlog

All spec documents from 09 onward are still unimplemented. The following task lists describe every remaining item. Check `[x]` when a task is complete; leave `[ ]` when it still needs work.

### Spec 09: Game Engine Abstraction / Multi-Game Architecture
- [x] Shared models in `games/core/models.js` align Badugi with the future engine.
- [x] `GameEngine` base class (`games/core/gameEngine.js`) exposes init/forced-bet/action/showdown/observation APIs.
- [x] Added base classes for draw/board/stud families.
- [x] `GameEngineContext` + `GameEngineProvider` allow switching engines via `?game=` query.
- [x] Move legacy `roundFlow.js` / `drawRound.js` / `showdown.js` logic into BadugiEngine.
- [x] Register BadugiEngine in `engineRegistry.js` and cover it with a unit test.
- [ ] Drive `ui/App.jsx` updates exclusively through GameEngine state.
- [x] `BadugiEngine.getObservation()` returns pot/street/acting seat data for RL.
- [x] `engineTableRef` + `syncEngineTableSnapshot()` keep UI logs and engine state in sync.
- [x] Add dedicated engine-focused unit tests (`games/__tests__/badugiEngine.test.js`).
- [x] Introduce domain-specific exceptions (e.g., `IllegalActionError`).
- [x] Mirror engine metadata (`currentBet` / `betHead` / `lastAggressor`) into UI state after every forced bet/action.
- [x] Hero BET handlers delegate to shared reducers (`resolveHeroFold/Call/Raise`) so logic is centralized before moving into BadugiEngine.
- [x] NPC BET handlers share the same dispatcher so Fold/Call/Raise logging and engine metadata remain consistent regardless of who acts.
- [x] Implement BET action resolution (`Fold/Call/Raise`) inside `BadugiEngine.applyPlayerAction()` and treat UI handlers as thin wrappers.
  - `ui/App.jsx` already calls the `resolve*` helpers and merges engine data via `mergeEnginePlayers()` so the UI only handles logging and animation.
- [ ] Document the migration plan in `docs/engine_migration.md`.

### Spec 10: Multi-Game List & Requirements
- [x] Enumerate every variant in `games/config/multiGameList.json` (Hold'em / Omaha / Draw / Stud / Dramaha).
- [x] Define `games/config/variantProfiles.js` (deck size, evaluator type, street flow, summary).
- [x] Extend GameSelector UI with family tabs, search, and variant cards (`/games` route + Title nav button).
- [x] Implement `resolveGameProfile()` so the UI can derive blind/ante/stack metadata per variant.
- [x] Add requirement checks (`games/core/requirements.js`) so the UI knows when board/draw/stud renderers are needed.
- [x] Feed variant data into Mixed Game rotation (Mixed builder now consumes `GAME_VARIANTS` plus status flags).
- [x] Export variant metadata JSON for RL/AI tooling via `npm run variants:export` -> `src/docs/variant_metadata.json`.
- [x] Add i18n entries for variant names/descriptions (`src/i18n/variants.ja.json` auto-generated).
- [x] Generate `docs/game_catalog.md` summarizing every variant (auto-generated by the export script).
- [x] Add sanity tests that validate each variant definition (`games/config/__tests__/variantCatalog.test.js`).

### Spec 11: Mixed Game Spec
- [x] Create `config/mixed/mixedProfiles.json` with rotation presets, hand counts, and timers.
- [x] Build a Mixed Game editor UI at `/mixed` so designers can tweak game lists, timers, and category toggles.
- [x] Implement `MixedGameContext` controller that swaps GameEngines hand-by-hand and persists runtime state.
- [x] Display current and next game in the HUD plus overlay badges.
- [x] Integrate rotation state with `tournamentManager` and seat rebalancing (persisted `mixedState` syncs the multi-table session).
- [x] Apply correct blind/ante rules for ring vs tournament rotations (variant profiles drive forced bets per stage).
- [x] Log Mixed-game hands to Spec08 history with `gameId`, rotation metadata, and the `MIXED_GAME_SWITCH` marker.
- [x] Add rotation flow tests that cover sequence correctness, HUD updates, and save/resume behavior.

### Spec 12: World Championship Unlock
- [x] Track unlock state in `playerProgress` (stage win counters, timestamps, clear counts).
- [x] Implement `computeUnlockState()` so the UI can show the required win chain and highlight the next milestone.
- [x] Build unlock animation modal and wire it into GameSelector and Title (Mixed button + HUD messaging).
- [x] Gate menus and Mixed profiles based on unlock state (Title, GameSelector, Mixed builder).
- [x] Store unlock events in tournament history plus Spec08 logs (`WORLD_CHAMP_CLEAR` / `WORLD_CHAMP_RECLEAR`).
- [x] Add unit coverage for unlock helpers (`ui/utils/__tests__/playerProgress.test.js`).

### Spec 13: Codex Automated Development Pipeline
- [x] Add `.devtools/auto_tasks.yaml` with at least five sample tasks.
- [x] Provide `.devtools/codex_prompt_template.txt` with token placeholders.
- [x] Implement `.devtools/codex_worker.js` (load task -> build prompt -> call Codex -> write file -> git commit/PR).
- [x] Create unit tests covering worker error paths (YAML parse, empty output, duplicate PR).
- [x] Add `.github/workflows/codex_nightly.yml` (daily schedule + manual dispatch).
- [x] Archive worker logs as Action artifacts.
- [x] Enforce commit/PR naming: "Codex AutoPR - {{TASK_ID}} {{TASK_TITLE}}".
- [x] Mark tasks as `skipped` when Codex output is invalid.
- [x] Document the pipeline in `docs/codex_pipeline.md`.

### Spec 14: Evaluator Architecture
- [x] Implement unified evaluator API in `games/evaluators/core.js`.
- [x] Build a shared high-hand evaluator for Hold'em / Omaha / Stud high variants.
- [x] Build lowball evaluators (2-7, A-5) and Badugi low/high implementations.
- [x] Add split-pot helpers (Hi-Lo8, Badeucey, Badacey) that return primary and secondary ranks.
- [x] Register evaluators through `games/evaluators/registry.js` and expose `evaluateHand`.
- [x] Migrate the Badugi engine and utils to the new registry and remove legacy evaluator logic.
- [x] Add `games/evaluators/__tests__/evaluator.test.js` plus Badugi engine tests to cover payouts/ties.
- [x] Document the architecture in this roadmap entry while keeping the API pure and side-effect free.
- [x] Provide hooks for future benchmarking scripts via the registry (split evaluator components are modular).

### Spec 15: UI / UX Flow
- [x] Move design tokens (color, spacing, typography) into `styles/designTokens.js`.
- [x] Redesign Title Screen per Spec 15 (hero copy + START to Main Menu flow).
- [x] Rebuild Main Menu / GameSelector navigation hierarchy with unlock badges.
  - [x] Create Mixed Game setup UI (Spec 11 integration).
- [x] Refresh Tournament setup with Spec 17 blind-sheet previews.
- [ ] Refactor Table Screen into reusable subcomponents.
- [x] Add Result screens (ring / tournament / mixed overlays).
  - [x] `HandResultOverlay` shows pot, winners, and Mixed rotation context.
  - [x] `TournamentResultOverlay` summarizes placement, prize, and next actions.
  - [x] Expand History screen with filters, search, and a detail drawer.
  - [x] Extend Settings screen (theme, audio, controller, pipeline status).
- [ ] Standardize modal and notification components.
- [x] Codify responsive design rules (Title/Menu/Selector now use shared tokens and grids).
- [ ] Monitor UI performance targets (load < 3 s, interaction < 100 ms).

### Spec 16: Mixed Game Pro
- [x] Add pro rotation presets (HORSE / 8-Game / 10-Game / Dealer's Choice) and surface quick-load cards throughout Game Selector + Mixed Builder.
- [x] Support weighted rotation and category-based Dealer's Choice modes (`WEIGHTED` / `CATEGORY` filters in the UI).
- [x] Implement pro rules (declaration, bring-in, kill blinds) with validation via `games/config/proRules.js` and SB/BB kill mechanics.
- [x] Add a pro HUD that highlights formats, bet sizing, and rotation context.
- [x] Enforce rule violations with UI warnings (`ruleWarnings` HUD + `PRO_RULE_WARNING` event).
- [ ] Hook Spec 18 AI profiles for pro rotations.
  - [x] Already wired `config/mixed/proAiProfiles.js` plus NPC BET/DRAW handlers to support those profiles.
- [x] Extend logging/history for pro rotations (`recordActionToLog` records format, selection mode, weighted tables, and history metadata).
- [x] Dealer's Choice roulette emits `DEALERS_CHOICE_SWITCH` and keeps the HUD and queue up to date.
- [x] `ui/dealersChoice/dealerChoiceManager.test.js` records FIFO queue behavior for the roulette loader.
- [x] Auto-disable Dealer's Choice during Mixed/Tournament mode so HUD/forced bets stay consistent.
- [x] Call `disableDealerChoiceMode("tournament")` and emit `dealersChoice:disabled` when a tournament starts.
- [x] Playwright scenario `python -m tests.scraping.runner dealers-choice` runs spin -> select -> deal flows.
- [x] Add Playwright scenarios for rotation, kill blinds, and declaration warnings (`mixed-rotation`, `pro-rules`).
- [x] Dealer's Choice roulette queue links `/game?mode=dealers-choice` and ships with `tests/scraping/scenarios/dealers_choice.md`.

### Spec 17: Pro Tournament System
- [x] Define pro blind sheets (`config/tournament/proBlindSheets.json`).
- [ ] Implement advanced multi-table balancing and logs.
- [ ] Add a break system with timers and UI countdown.
- [ ] Implement final-table presentations (animations, banners, camera zoom).
- [ ] Load prize structures dynamically as the tournament advances.
- [ ] Track player progression, eliminations, and leaderboard stats.
- [ ] Add a pro HUD (avg stack, BB counts, remaining tables).
- [ ] Tune AI tiers for pro tournaments (Spec 18 integration).
- [ ] Extend Spec08 logs with ITM, finish, and hand counts.
- [ ] Add acceptance tests that validate blind sheet accuracy and balancing behavior.

### Spec 19: CPU Difficulty Tier System
- [x] Create `config/ai/tiers.json` (Novice -> Boss -> WorldMaster equivalent) to drive CPU tuning.
- [x] Track KPI metrics (VPIP/PFR/AF/Bluff/SD%) per CPU via `opponentModel`.
- [x] Wire tier parameters (ranges, raise sizes, draw counts) into NPC logic.
- [x] Auto-assign tiers per tournament stage / Mixed profile.
- [x] Implement dynamic difficulty adjustments (KPI-driven tier drift after showdowns).
- [x] Map tiers to AI models (Spec 18) via `resolveTierModelInfo` + ONNX registry.
- [x] Show tier badges/tooltips in the HUD (PlayerStatusBoard overlay).
- [x] Log tier changes (Spec 08) with KPI snapshots and reasons.
- [x] Add developer tuning panel (Title Settings > AI Tier Tuning).

### Spec 20: User Rank / P2P Global Rating
- [x] Implement rating state (Skill/Style/Mixed) in `ui/utils/ratingState.js` + `useRatingState`.
- [x] Build Elo/Elo-lite updater (`applyMatchRatings`) with history + system log hooks.
- [x] Analyze style metrics (aggression, bluff rate, showdown rate) via style diagnostics + profile buckets.
- [x] Compute mixed rating using rotation history (rotation history + mixed weight).
- [x] Feed P2P match data into the RL pipeline (capture buffer + export helper).
- [x] Build global leaderboard UI with filters/search (/leaderboard).
- [x] Add anti-cheat heuristics for rating anomalies (delta + farming detection).
- [x] Show rating badges on Title / Tournament screens (rating HUD cards).
- [x] Extend Spec08 logs with rating updates (system events + history entries).

### Spec 21: Backend API / Server Sync
- [x] Scaffold `server/` (FastAPI + routers + requirements).
- [x] Implement auth (JWT/OAuth) and client SDK (token + demo flows).
- [x] Add main API endpoints (`/profile`, `/history`, `/tournament`, `/tasks`, `/ai-models`).
- [x] Implement sync manager (delta + snapshot) on the client.
- [x] Define DB schema (players, sessions, ratings, models, unlocks).
- [x] Add AI model sync endpoints (Spec 18).
- [x] Support tournament resume API.
- [ ] Add security middleware (rate limit, validation, audit log).
- [ ] Provide CLI tools for Codex pipeline to hit the API.
- [ ] Add CI contract tests.

### Spec 22: P2P Online Play Pre-design
- [ ] Implement `p2p/roomManager.ts` (lobbies, matchmaking).
- [ ] Build WebSocket sync layer + message schema.
- [ ] Secure card distribution (hashing, verification).
- [ ] Implement P2P gameplay state machine (deal -> action -> showdown).
- [ ] Log P2P matches with Spec08 schema.
- [ ] Hook P2P results into ratings (Spec 20).
- [ ] Handle connection loss (reconnect, bot takeover, timeouts).
- [ ] Prepare cross-platform input handling.
- [ ] Stub spectator mode and WebRTC direct mode for future work.
- [ ] Publish REST + WebSocket API docs (OpenAPI/AsyncAPI).
- [ ] Add anti-cheat / fairness monitoring for online games.

### Spec 23: App.jsx State Restoration
- [ ] Reconcile `ui/App.jsx`â€™s documented behaviors (seat manager/hero tracker/rating HUD/developer panel, SB/BB clamp guards, draw/bet transitions, logging hooks, and engine metadata sync) with the descriptions in `docs/bug_fixes.md`/`docs/engine_migration.md` to confirm nothing was lost during the rollback.
- [ ] Re-implement or verify the App helpers named in those docs (`hasActedThisRound`, `shiftAggressorsAfterFold`, `recordActionToLog` wiring, hero tracker storage, developer panel toggles) and note any gaps in this Spec23 entry so there is a clear follow-up if the codebase deviates again.
- [ ] After the above is confirmed, capture the updated checklist details for Spec23 (marking each item as complete) so future roadmap audits can rely on this record before closing the spec.
